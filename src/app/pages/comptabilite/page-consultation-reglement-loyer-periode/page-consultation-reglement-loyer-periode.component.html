<div class="col">
  <div class="row m-3">
    <div class="col-md-8 p-0">
      <h1>Consultation des reglements de loyer</h1>
    </div>
    <div class="col-md-4 text-right"></div>
  </div>

  <div class="row">
    <div class="col">
      <h5>
        <i class="fas fa-asterisk blue-color"></i>&nbsp;Selection de la periode
      </h5>
    </div>
  </div>
  <hr style="margin-top: 0" />
  <div
    class="row mt-2 ml-2"
    style="
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 10px;
    "
  >
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Date début</mat-label>
        <input
          [(ngModel)]="debut"
          matInput
          [matDatepicker]="picker"
          data-date-format="yyyy-mm-dd"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Date fin</mat-label>
        <input
          [(ngModel)]="fin"
          matInput
          [matDatepicker]="picker1"
          data-date-format="yyyy-mm-dd"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="picker1"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>
    </div>
    <div style="flex-grow: 1">
      <button
        (click)="getAllEncaissementParPeriode(debut, fin);getListEncaissementParPeriode(debut, fin)"
        mat-raised-button
        color="primary"
        type="button"
        class="mr-1"
        style="height: 40px"
      >
        <mat-icon>search</mat-icon>
        Recherche
      </button>
    </div>
  </div>
  <div class="tab-content" id="myTabContent">
    <div class="col-md-8 p-0">
      <h2>Sortie de caisse</h2>
    </div>
    <!-- user table -->
    <div class="mat-elevation-z8">
      <mat-form-field class="tail-40">
        <input
          matInput
          (keyup)="applyFilter($event)"
          #input
          placeholder="Rechercher générale dans le tableau"
        />
      </mat-form-field>
      <div style="flex-grow: 2">
        <ng-container
          *ngIf="suiviDepense$ | async as suiviDepenseState"
          [ngSwitch]="suiviDepenseState.dataState"
        >
          <ng-container *ngSwitchCase="SuiviDepenseStateEnum.LOADED">
            <h5>
              {{
                suiviDepenseState.totalEncaisse.totalMontantDepense
                  | currency : "XOF" : "symbol"
              }}
            </h5>
          </ng-container>
        </ng-container>
      </div>
      <div class="row m-3">
        <div class="col-md-6 p-0">
          <!-- <button mat-button color="warn">Warn</button> -->
          <button
            mat-button
            mat-raised-button
            color="accent"
            (click)="exporter.exportTable('xlsx', { fileName: 'sorti_caisse' })"
          >
            Exporter en Excel
            <mat-icon>insert_drive_file</mat-icon>
          </button>
        </div>
        <!-- SORTI DE CAISSE PAR PERIODES-------->
        <mat-paginator
          #tableDepense
          showFirstLastButtons
          [pageSizeOptions]="pageSize"
          aria-label="Select page of users"
        >
        </mat-paginator>
        <mat-table #tableDepense [dataSource]="dataSourceSuivi" matSort>
          <!-- Code colonne -->
          <ng-container matColumnDef="id">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              id
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.id }}
            </mat-cell>
          </ng-container>
          <!-- Dénomination colonne -->
          <ng-container matColumnDef="dateEncaissement">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Date d'encaissement
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.dateEncaissement | date : "dd/MM/yyyy" }}
            </mat-cell>
          </ng-container>

          <!-- Propriétaire colonne -->
          <ng-container matColumnDef="codeTransaction">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Code Transaction
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.codeTransaction }}</mat-cell
            >
          </ng-container>

          <ng-container matColumnDef="montantDepense">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Montant
            </mat-header-cell>
            <mat-cell *matCellDef="let row"> {{ row.montantDepense | currency : "XOF" : "symbol" }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="designation">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Description
            </mat-header-cell>
            <mat-cell *matCellDef="let row"> {{ row.designation }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="modePaiement">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Mode de Paiement
            </mat-header-cell>
            <mat-cell *matCellDef="let row"> {{ row.modePaiement }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="operationType">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Type d'opération
            </mat-header-cell>
            <mat-cell *matCellDef="let row"> {{ row.operationType }}</mat-cell>
          </ng-container>
          <!-- Propriétaire colonne -->

          <!-- Actions colonne -->

          <mat-header-row *matHeaderRowDef="displayedColumnsSuiviDepense">
          </mat-header-row>
          <mat-row
            *matRowDef="let row; columns: displayedColumnsSuiviDepense"
          ></mat-row>
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">
              Aucune donnée enregistrée {{ input.value }}
            </td>
          </tr>
        </mat-table>
        <!-- FIN TABLE DEPENSE-->
      </div>
    </div>
    <div class="tab-content" id="myTabContent">
      <div class="col-md-8 p-0">
        <h2>Recouvrement des loyers</h2>
      </div>
      <!-- user table -->
      <div class="mat-elevation-z8">
        <mat-form-field class="tail-40">
          <input
            matInput
            (keyup)="applyFilter($event)"
            #input
            placeholder="Rechercher générale dans le tableau"
          />
        </mat-form-field>
        <div style="flex-grow: 2">
          <ng-container
            *ngIf="suiviDepense$ | async as suiviDepenseState"
            [ngSwitch]="suiviDepenseState.dataState"
          >
            <ng-container *ngSwitchCase="SuiviDepenseStateEnum.LOADED">
              <h5>
                {{
                  suiviDepenseState.totalEncaisse.totalMontantDepense
                    | currency : "XOF" : "symbol"
                }}
              </h5>
            </ng-container>
          </ng-container>
        </div>
        <div class="row m-3">
          <div class="col-md-6 p-0">
            <!-- <button mat-button color="warn">Warn</button> -->
            <button
              mat-button
              mat-raised-button
              color="accent"
              (click)="
                exporter.exportTable('xlsx', { fileName: 'Appel_loyer' })
              "
            >
              Exporter en Excel
              <mat-icon>insert_drive_file</mat-icon>
            </button>
          </div>
          <div class="col-md-6 text-right">
            <mat-paginator
              #matimmeuble
              showFirstLastButtons
              [pageSizeOptions]="pageSize"
              [length]="totalRecords!"
            >
            </mat-paginator>
          </div>
        </div>

        <mat-table
          #table
          matTableExporter
          [dataSource]="dataSource"
          matSort
          #exporter="matTableExporter"
        >
          <!-- Code colonne -->
          <ng-container matColumnDef="periode">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Période
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.periodeLettre }}
            </mat-cell>
          </ng-container>

          <!-- Dénomination colonne -->
          <ng-container matColumnDef="bail">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Bail
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.nomLocataire }} {{ row.prenomLocataire }} \
              {{ row.abrvBienimmobilier }}
            </mat-cell>
          </ng-container>

          <!-- Propriétaire colonne -->
          <ng-container matColumnDef="montantloyer">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Montant Loyer
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.nouveauMontantLoyer }}</mat-cell
            >
          </ng-container>

          <ng-container matColumnDef="solde">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Solde
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              {{ row.soldeAppelLoyer }}</mat-cell
            >
          </ng-container>
          <!-- Propriétaire colonne -->
          <ng-container matColumnDef="Status">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Status
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              <span
                *ngIf="row.statusAppelLoyer == 'Soldé'"
                class="badge badge-success"
                >{{ row.statusAppelLoyer }}</span
              >
              <span
                *ngIf="row.statusAppelLoyer == 'Impayé'"
                class="badge badge-danger"
                >{{ row.statusAppelLoyer }}</span
              >
              <span
                *ngIf="row.statusAppelLoyer == 'partiellement payé'"
                class="badge badge-warning"
                >{{ row.statusAppelLoyer }}</span
              >
            </mat-cell>
          </ng-container>
          <!-- Actions colonne -->
          <ng-container matColumnDef="Actions">
            <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
            <mat-cell *matCellDef="let row">
              <div class="btn-group">
                <button mat-icon-button color="primary">
                  <mat-icon>print</mat-icon>
                </button>
              </div>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"> </mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">
              Aucune donnée enregistrée {{ input.value }}
            </td>
          </tr>
        </mat-table>
      </div>
    </div>
  </div>
</div>
